(window.webpackJsonp=window.webpackJsonp||[]).push([[128],{438:function(t,s,a){"use strict";a.r(s);var n=a(19),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"node-09-mongoose"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#node-09-mongoose"}},[t._v("#")]),t._v(" node-09 mongoose")]),t._v(" "),a("h2",{attrs:{id:"一、mongoose"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一、mongoose"}},[t._v("#")]),t._v(" 一、mongoose")]),t._v(" "),a("ol",[a("li",[t._v("原生mongodb:")])]),t._v(" "),a("p",[t._v("可以安装：npm i mongodb（原生的mongodb写法）")]),t._v(" "),a("p",[t._v("现在都是使用mongoose，封装的mongodb；")]),t._v(" "),a("ol",{attrs:{start:"2"}},[a("li",[t._v("mongoose安装")])]),t._v(" "),a("p",[t._v("npm i mongoose；安装到项目文件夹；")]),t._v(" "),a("ol",{attrs:{start:"3"}},[a("li",[t._v("mongoose对象：")])]),t._v(" "),a("p",[t._v("（1）Schema：约束（设计集合[表]结构的同时约束数据类型）；")]),t._v(" "),a("p",[t._v("（2）Model：模型 | 表 | 集合，用来操作具体的数据；")]),t._v(" "),a("p",[t._v("（3）document：一条一条的记录")]),t._v(" "),a("ol",{attrs:{start:"4"}},[a("li",[t._v("mongoose操作mongodb的步骤")])]),t._v(" "),a("p",[t._v("（1）开启服务")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("   "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//  并引入mongoose")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" mongoose "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'mongoose'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("；\n\n   "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 连接数据库")]),t._v("\nmongoose"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("connect")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("'mongodb"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("localhost"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("27017")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("test"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("useNewUrlParser"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("；\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//27017端口可以省略，默认端口是27017；")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 定义Schema")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" Schemas "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" mongoose"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Schema"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" SchemaObj "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Schemas")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    uname"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("String"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    age"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("Number"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    sex"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        type"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("String"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'男'")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("p",[t._v("（5）根据Schema创建Model对象（创建数据库名）")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//数据库名需要加s，会转变副词，自动加s；")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" modelObj "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" mongoose"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("model")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'users'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("SchemaObj"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("；\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 通过Model对象进行CRUD操作（需要创建多个可以写入一个数组）")]),t._v("\nmodelObj"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("create")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("uname"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'hny'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("age"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("18")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("sex"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'男'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("err")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("err"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'ok'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("；\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("h2",{attrs:{id:"二、model-find-方法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#二、model-find-方法"}},[t._v("#")]),t._v(" 二、Model.find()方法")]),t._v(" "),a("ol",[a("li",[a("code",[t._v("Model.find(conditions[,projection][,options][,callback])")]),t._v(";  返回一个数组；")])]),t._v(" "),a("p",[t._v("（1）conditions：find条件，查询的条件值可以为正则；")]),t._v(" "),a("p",[t._v("（2）projection：要展示的字段，0为不显示，1为显示，如果不需要设置，可以写null；")]),t._v(" "),a("p",[t._v("也可以使用字符串，用空格分开，不显示的用-减号；")]),t._v(" "),a("p",[t._v("示例：model.find({name:/li/i},'name -_id',()=>{})；")]),t._v(" "),a("p",[t._v("（3）options：查询选项，sort(排序)，limit(限制)，skip(跳过)；")]),t._v(" "),a("p",[t._v("（4）callback：回调函数，查找到的结果，从回调函数中获取所以函数需要两个形参(err,docs)；")]),t._v(" "),a("p",[t._v("示例：model.find({name:'hny'},null,{skip:5},(err,dosc)=>{})；")]),t._v(" "),a("p",[t._v("如果不传递回调函数，则不会自动执行，返回一个query对象，需要调用exec()方法才能执行；")]),t._v(" "),a("p",[t._v("推荐使用不传递回调函数，方便前者指定复杂的条件，可以通过链式调用；")]),t._v(" "),a("h2",{attrs:{id:"三、model-update-方法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#三、model-update-方法"}},[t._v("#")]),t._v(" 三、Model.update()方法")]),t._v(" "),a("ol",[a("li",[t._v("model.update(条件,修改的内容[,options][,callback])；")])]),t._v(" "),a("p",[t._v("（1）修改多条需要加{multi:true}；")]),t._v(" "),a("p",[t._v("（2）不建议使用update(),建议使用以下两种方法")]),t._v(" "),a("ol",{attrs:{start:"2"}},[a("li",[t._v("model.updateOne()；")]),t._v(" "),a("li",[t._v("model.updateMany()；")])]),t._v(" "),a("h2",{attrs:{id:"四、查询条数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#四、查询条数"}},[t._v("#")]),t._v(" 四、查询条数")]),t._v(" "),a("ol",[a("li",[t._v("model.countDocuments({条件},(err,cont)=>{})；")])]),t._v(" "),a("h2",{attrs:{id:"五、model-remove-；"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#五、model-remove-；"}},[t._v("#")]),t._v(" 五、Model.remove()；")]),t._v(" "),a("ol",[a("li",[t._v("model.remove(条件,fn)；")]),t._v(" "),a("li",[t._v("model.deleteOne()；")]),t._v(" "),a("li",[t._v("model.deleteMany()；")])]),t._v(" "),a("h2",{attrs:{id:"六、findbyidandupdate-条件-修改内容-限制-fn-；通过id修改内容；"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#六、findbyidandupdate-条件-修改内容-限制-fn-；通过id修改内容；"}},[t._v("#")]),t._v(" 六、findByIdAndUpdate('条件','修改内容','限制',fn)；通过id修改内容；")]),t._v(" "),a("h2",{attrs:{id:"六、文档对象"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#六、文档对象"}},[t._v("#")]),t._v(" 六、文档对象")]),t._v(" "),a("ol",[a("li",[t._v("添加数据：")])]),t._v(" "),a("p",[t._v("cur = model({})；cur.save()；直接使用model创建数据，之后保存；")]),t._v(" "),a("p",[t._v("不需要调用model.create就可以创建数据；")]),t._v(" "),a("ol",{attrs:{start:"2"}},[a("li",[t._v("find查找到数据之后可以直接操作查找到的数据，之后调用save()一下；")])]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("model"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("find")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("err"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("docs")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    docs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'lishi'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    docs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("save")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("；\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("ol",{attrs:{start:"3"}},[a("li",[t._v("可以通过docs.toObject()转成普通对象，之后是不等于docs的；")])])])}),[],!1,null,null,null);s.default=e.exports}}]);